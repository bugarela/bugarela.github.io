<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Personal homepage exported with org-thtml">

  <title>Primeiras Especificações em TLA+</title>
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <meta property="og:url" content="https://bugarela.com/mfo/20240408201756-mfo_primeiras_especificacoes_em_tla.html" />
  <meta property="og:title" content="Primeiras Especificações em TLA+" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="Personal homepage exported with org-thtml" />
  
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bugarela">
    <meta name="twitter:title" content="Primeiras Especificações em TLA+">
    <meta name="twitter:description" content="Personal homepage exported with org-thtml">
  

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/pure-min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-responsive-min.css">
<link rel="stylesheet" href="../css/layouts/style.css">

  </head>
  <body>
    <div id="layout" class="pure-g">
      <div class="sidebar pure-u-1 pure-u-md-1-3">
  <div class="pure-g">
    <div class="pure-u-1 pure-u-lg-1-2">
    </div>
    <div class="pure-u-1 pure-u-lg-1-2">
      <div class="header">
        <h2 class="brand-title"><a href="../"><i class="fas fa-home"></i> Gabriela Moreira</a></h2>
      </div>
      <div class="centered">
        <h1 class="huge"><i class="fas fa-folder-open"></i></h1>
        <h1 class="huge"><a href="./">MFO</a></h1>
        <h2 class="brand-title">Métodos Formais</h2>
        <h2 class="brand-tagline">Materiais da disciplina</h2>
      </div>
      <div class="footer">
  <div>Created using Emacs and <a href="https://github.com/juanjosegarciaripoll/org-thtml">org-mode</a></div>
</div>

    </div>
  </div>
</div>

      <div class="content pure-u-1 pure-u-md-2-3">
        <h2>Primeiras Especificações em TLA+</h2>
        <a href="https://bugarela.com/mfo/slides/20240408201756-mfo_primeiras_especificacoes_em_tla.pdf">Slides</a><br />
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#corre-o-exerc-cios-1">1. Correção exercícios</a>
<ul>
<li><a href="#corre-o-dos-exerc-cios-2">1.1. Correção dos exercícios</a></li>
</ul>
</li>
<li><a href="#modelos-em-tla-1">2. Modelos em TLA+</a>
<ul>
<li><a href="#modelos-em-tla-2">2.1. Modelos em TLA+</a></li>
</ul>
</li>
<li><a href="#sem-foros-1">3. Semáforos</a>
<ul>
<li><a href="#especifica-o-para-os-sem-foros-2">3.1. Especificação para os semáforos</a></li>
<li><a href="#estado-inicial-2">3.2. Estado inicial</a></li>
<li><a href="#pr-ximo-sem-foro-fica-verde-2">3.3. Próximo semáforo fica verde</a></li>
<li><a href="#pr-ximo-sem-foro-fica-verde-exerc-cio-2">3.4. Próximo semáforo fica verde: Exercício</a></li>
<li><a href="#proximo-semaforo-fica-verde-exercicio">3.5. Próximo semáforo fica verde: Exercício</a></li>
<li><a href="#um-sem-foro-que-est-verde-fica-amarelo-2">3.6. Um semáforo que está verde fica amarelo</a></li>
<li><a href="#um-sem-foro-que-est-amarelo-fica-vermelho-2">3.7. Um semáforo que está amarelo fica vermelho</a></li>
<li><a href="#fun-o-de-pr-ximo-estado-2">3.8. Função de próximo estado</a></li>
<li><a href="#propriedades-2">3.9. Propriedades</a></li>
</ul>
</li>
<li><a href="#jogo-da-velha-1">4. Jogo da Velha</a>
<ul>
<li><a href="#jogo-da-velha-em-tla-2">4.1. Jogo da Velha em TLA+</a></li>
<li><a href="#m-dulo-2">4.2. Módulo</a></li>
<li><a href="#tipos-e-vari-veis-2">4.3. <del>Tipos e</del> variáveis</a></li>
<li><a href="#defini-es-sobre-coordenadas-e-tabuleiro-2">4.4. Definições sobre coordenadas e tabuleiro</a></li>
<li><a href="#definindo-ganhar-coordenadas-2">4.5. Definindo &ldquo;ganhar&rdquo; - coordenadas</a></li>
<li><a href="#definindo-ganhar-operador-won-2">4.6. Definindo &ldquo;ganhar&rdquo; - operador won</a></li>
<li><a href="#a-es-move-2">4.7. Ações - Move</a></li>
<li><a href="#a-es-movetoempty-2">4.8. Ações - MoveToEmpty</a></li>
<li><a href="#a-es-moveo-2">4.9. Ações - MoveO</a></li>
<li><a href="#estrat-gia-para-o-jogador-x-2">4.10. Estratégia para o jogador X</a></li>
<li><a href="#come-ando-com-os-cantos-2">4.11. Começando com os cantos</a></li>
<li><a href="#condi-es-para-as-jogadas-2">4.12. Condições para as jogadas</a></li>
<li><a href="#a-es-win-2">4.13. Ações - Win</a></li>
<li><a href="#a-es-blockwin-2">4.14. Ações - BlockWin</a></li>
<li><a href="#a-es-takecenter-e-setupwin-2">4.15. Ações - TakeCenter e SetupWin</a></li>
<li><a href="#a-es-movex-2">4.16. Ações - MoveX</a></li>
<li><a href="#estado-inicial-2-2">4.17. Estado inicial</a></li>
<li><a href="#transi-es-2">4.18. Transições</a></li>
<li><a href="#invariantes-2">4.19. Invariantes</a></li>
<li><a href="#refer-ncias-2">4.20. Referências</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-corre-o-exerc-cios-1" class="outline-2">
<h2 id="corre-o-exerc-cios-1"><span class="section-number-2">1.</span> Correção exercícios</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-corre-o-dos-exerc-cios-2" class="outline-3">
<h3 id="corre-o-dos-exerc-cios-2"><span class="section-number-3">1.1.</span> Correção dos exercícios</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Vamos corrigir juntos no VSCode.<br />
</p>

<ul class="org-ul">
<li>Mostrar em PDF<br /></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-modelos-em-tla-1" class="outline-2">
<h2 id="modelos-em-tla-1"><span class="section-number-2">2.</span> Modelos em TLA+</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-modelos-em-tla-2" class="outline-3">
<h3 id="modelos-em-tla-2"><span class="section-number-3">2.1.</span> Modelos em TLA+</h3>
<div class="outline-text-3" id="text-modelos-em-tla-2">
<p>
Até agora, vimos principalmente a parte funcional da linguagem.<br />
</p>
<ul class="org-ul">
<li>Diferente de Quint, não temos operadores exclusivos para ações. Ações são bem parecidas com a parte funcional.<br /></li>
<li>Podemos identificar ações pelo operador <i>primed</i> (<code>'</code> ), e pelo <code>UNCHANGED</code><br /></li>
</ul>

<p>
<b>Estado inicial:</b><br />
</p>
<ul class="org-ul">
<li>Em Quint, o estado inicial é uma ação (como <code>x' = 0</code>)<br /></li>
<li>Em TLA+, o estado inicial é um predicado (como <code>x = 0</code>, que em Quint seria <code>x==0</code>).<br />
<ul class="org-ul">
<li>Lemos como &ldquo;Um estado é um estado inicial sse satisfaz \(Init\)&rdquo;<br /></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sem-foros-1" class="outline-2">
<h2 id="sem-foros-1"><span class="section-number-2">3.</span> Semáforos</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-especifica-o-para-os-sem-foros-2" class="outline-3">
<h3 id="especifica-o-para-os-sem-foros-2"><span class="section-number-3">3.1.</span> Especificação para os semáforos</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-tla">----- <span style="color: #66a4a4;">MODULE</span> Semaforos ------
<span style="color: #66a4a4;">EXTENDS</span> Integers, FiniteSets
<span style="color: #66a4a4;">VARIABLE</span> cores, proximo
<span style="color: #66a4a4;">CONSTANT</span> SEMAFOROS
<span style="color: #C18E76;">\* ...</span>
=============================
</pre>
</div>

<p>
PS: Consultei a <a href="https://github.com/tlaplus/tlaplus-standard/blob/main/grammar/TLAPlus2Grammar.tla">gramática</a> de TLA+ e precisamos de pelo menos 4 hífens (<code>----</code> ) antes e depois de <code>MODULE nome</code> e pelo menos 4 iguais (<code>====</code>) no final.<br />
</p>

<div class="org-src-container">
<pre class="src src-tla">TLAPlusGrammar == <span style="color: #C18E76;">\* ...</span>
  G.Module ::= AtLeast4(<span style="color: #98971a;">"-"</span>)
    &amp; tok(<span style="color: #98971a;">"MODULE"</span>) &amp; Name &amp; AtLeast4(<span style="color: #98971a;">"-"</span>)
    &amp; (Nil | (tok(<span style="color: #98971a;">"EXTENDS"</span>) &amp; CommaList(Name)))
    &amp; (G.Unit)^*
    &amp; AtLeast4(<span style="color: #98971a;">"="</span>) <span style="color: #C18E76;">\* ...</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-estado-inicial-2" class="outline-3">
<h3 id="estado-inicial-2"><span class="section-number-3">3.2.</span> Estado inicial</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-tla">Init ==
  /\ cores = [s \in SEMAFOROS |-&gt; <span style="color: #98971a;">"vermelho"</span>]
  /\ proximo = <span style="color: #d79921; font-weight: bold;">0</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-pr-ximo-sem-foro-fica-verde-2" class="outline-3">
<h3 id="pr-ximo-sem-foro-fica-verde-2"><span class="section-number-3">3.3.</span> Próximo semáforo fica verde</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-tla">FicaVerde(s) ==
  /\ proximo = s
  /\ \A s2 \in SEMAFOROS : cores[s2] = <span style="color: #98971a;">"vermelho"</span>
  /\ cores' = [cores <span style="color: #66a4a4;">EXCEPT</span> ![s] = <span style="color: #98971a;">"verde"</span>]
  /\ proximo' = (s + <span style="color: #d79921; font-weight: bold;">1</span>) % Cardinality(SEMAFOROS)
</pre>
</div>

<p>
Qual a pré-condição dessa ação?<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">/\ proximo = s
/\ \A s2 \in SEMAFOROS : cores[s2] = <span style="color: #98971a;">"vermelho"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-pr-ximo-sem-foro-fica-verde-exerc-cio-2" class="outline-3">
<h3 id="pr-ximo-sem-foro-fica-verde-exerc-cio-2"><span class="section-number-3">3.4.</span> Próximo semáforo fica verde: Exercício</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-tla">FicaVerde(s) ==
  /\ proximo = s
  /\ \A s2 \in SEMAFOROS : cores[s2] = <span style="color: #98971a;">"vermelho"</span>
  /\ cores' = [cores <span style="color: #66a4a4;">EXCEPT</span> ![s] = <span style="color: #98971a;">"verde"</span>]
  /\ proximo' = (s + <span style="color: #d79921; font-weight: bold;">1</span>) % Cardinality(SEMAFOROS)
</pre>
</div>

<p>
<b>Lendo essa ação</b>: tente prencher as lacunas<br />
&ldquo;<code>FicaVerde</code> para um semáforo <code>s</code> define uma transição onde, no estado atual, <code>__________</code> deve ser <code>__________</code> e <code>___________</code> deve <code>_________</code>; e no próximo estado, <code>_________</code> deve ser <code>_________</code> e <code>___________</code> deve ser <code>___________</code>&rdquo;<br />
</p>
</div>
</div>
<div id="outline-container-proximo-semaforo-fica-verde-exercicio" class="outline-3">
<h3 id="proximo-semaforo-fica-verde-exercicio"><span class="section-number-3">3.5.</span> Próximo semáforo fica verde: Exercício</h3>
<div class="outline-text-3" id="text-proximo-semaforo-fica-verde-exercicio">
<div class="org-src-container">
<pre class="src src-tla">FicaVerde(s) ==
  /\ proximo = s
  /\ \A s2 \in SEMAFOROS : cores[s2] = <span style="color: #98971a;">"vermelho"</span>
  /\ cores' = [cores <span style="color: #66a4a4;">EXCEPT</span> ![s] = <span style="color: #98971a;">"verde"</span>]
  /\ proximo' = (s + <span style="color: #d79921; font-weight: bold;">1</span>) % Cardinality(SEMAFOROS)
</pre>
</div>

<p>
<b>Possível resolução:</b><br />
&ldquo;<code>FicaVerde</code> para um semáforo <code>s</code> define uma transição onde, no estado atual, <span class="underline">o valor de proximo</span> deve ser <span class="underline">igual ao semáforo s</span> e <span class="underline">o valor de cores para cada semáforo em SEMAFOROS</span> deve ser vermelho; e no próximo estado, <span class="underline">o valor de cores</span> deve ser <span class="underline">igual a cores no estado atual, exceto que o valor de s deve ser verde</span> e <span class="underline">o valor de proximo</span> deve ser <span class="underline">o incremento do valor no estado atual módulo o tamanho do conjunto SEMAFOROS</span>&rdquo;.<br />
</p>
</div>
</div>
<div id="outline-container-um-sem-foro-que-est-verde-fica-amarelo-2" class="outline-3">
<h3 id="um-sem-foro-que-est-verde-fica-amarelo-2"><span class="section-number-3">3.6.</span> Um semáforo que está verde fica amarelo</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-tla">FicaAmarelo(s) ==
  /\ cores[s] = <span style="color: #98971a;">"verde"</span>
  /\ cores' = [cores <span style="color: #66a4a4;">EXCEPT</span> ![s] = <span style="color: #98971a;">"amarelo"</span>]
  /\ <span style="color: #66a4a4;">UNCHANGED</span> &lt;&lt; proximo &gt;&gt;
</pre>
</div>
<p>
Qual a pré-condição dessa ação?<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">cores[s] = <span style="color: #98971a;">"verde"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-um-sem-foro-que-est-amarelo-fica-vermelho-2" class="outline-3">
<h3 id="um-sem-foro-que-est-amarelo-fica-vermelho-2"><span class="section-number-3">3.7.</span> Um semáforo que está amarelo fica vermelho</h3>
<div class="outline-text-3" id="text-3-7">
<div class="org-src-container">
<pre class="src src-tla">FicaVermelho(s) ==
  /\ cores[s] = <span style="color: #98971a;">"amarelo"</span>
  /\ cores' = [cores <span style="color: #66a4a4;">EXCEPT</span> ![s] = <span style="color: #98971a;">"vermelho"</span>]
  /\ <span style="color: #66a4a4;">UNCHANGED</span> &lt;&lt; proximo &gt;&gt;
</pre>
</div>
<p>
Qual a pré-condição dessa ação?<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">cores[s] = <span style="color: #98971a;">"amarelo"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-fun-o-de-pr-ximo-estado-2" class="outline-3">
<h3 id="fun-o-de-pr-ximo-estado-2"><span class="section-number-3">3.8.</span> Função de próximo estado</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-tla">Next == \E s \in SEMAFOROS : FicaVerde(s) \/ FicaAmarelo(s) \/ FicaVermelho(s)
</pre>
</div>

<p>
Lembrando que TLA+ permite usarmos ações dentro de um <i>exists</i>, diferentemente de Quint onde é necessário usar o <code>nondet</code> e <code>oneOf</code>.<br />
</p>
</div>
</div>
<div id="outline-container-propriedades-2" class="outline-3">
<h3 id="propriedades-2"><span class="section-number-3">3.9.</span> Propriedades</h3>
<div class="outline-text-3" id="text-3-9">
<p>
Uma invariante para check de sanidade:<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">Inv == cores[<span style="color: #d79921; font-weight: bold;">2</span>] /= <span style="color: #98971a;">"amarelo"</span>
</pre>
</div>

<p>
Uma propriedade do sistema: para que os veículos não colidam, não podemos ter mais de um semáforo aberto ao mesmo tempo.<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">SemColisao == Cardinality({s \in SEMAFOROS : cores[s] = <span style="color: #98971a;">"verde"</span>}) &lt;= <span style="color: #d79921; font-weight: bold;">1</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-jogo-da-velha-1" class="outline-2">
<h2 id="jogo-da-velha-1"><span class="section-number-2">4.</span> Jogo da Velha</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-jogo-da-velha-em-tla-2" class="outline-3">
<h3 id="jogo-da-velha-em-tla-2"><span class="section-number-3">4.1.</span> Jogo da Velha em TLA+</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Vamos ver a mesma especificação do jogo da velha, agora em TLA+<br />
</p>
<ul class="org-ul">
<li>Vamos direto pra versão onde o jogador X usa estratégia<br /></li>
<li>Vou usar a versão original do autor (<a href="#citeproc_bib_item_1">SWART, 2022</a>)<br />
<ul class="org-ul">
<li>A especificação em Quint é baseada nesta, mas não é uma tradução direta. Poderíamos escrever a tradução mais próxima possível, mas não é esse o caso. Eu escrevi como achei que seria melhor, dado os recursos da linguagem.<br /></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-m-dulo-2" class="outline-3">
<h3 id="m-dulo-2"><span class="section-number-3">4.2.</span> Módulo</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-tla">-------- <span style="color: #66a4a4;">MODULE</span> tictactoexwin ---------

<span style="color: #66a4a4;">EXTENDS</span> Naturals

<span style="color: #C18E76;">\* ...</span>

=======================================
</pre>
</div>
</div>
</div>
<div id="outline-container-tipos-e-vari-veis-2" class="outline-3">
<h3 id="tipos-e-vari-veis-2"><span class="section-number-3">4.3.</span> <del>Tipos e</del> variáveis</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Definimos as seguintes variáveis<br />
</p>
<div class="org-src-container">
<pre class="src src-tla"><span style="color: #66a4a4;">VARIABLES</span>
  board, <span style="color: #C18E76;">\* board[1..3][1..3] A 3x3 tic-tac-toe board</span>
  nextTurn <span style="color: #C18E76;">\* who goes next</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-defini-es-sobre-coordenadas-e-tabuleiro-2" class="outline-3">
<h3 id="defini-es-sobre-coordenadas-e-tabuleiro-2"><span class="section-number-3">4.4.</span> Definições sobre coordenadas e tabuleiro</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-tla">BoardIs(coordinate, player) ==
    board[coordinate[<span style="color: #d79921; font-weight: bold;">1</span>]][coordinate[<span style="color: #d79921; font-weight: bold;">2</span>]] = player

BoardFilled ==
    <span style="color: #C18E76;">\* There does not exist</span>
    ~\E i \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>, j \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>:
        <span style="color: #C18E76;">\* an empty space</span>
        <span style="color: #66a4a4;">LET</span> space == board[i][j] <span style="color: #66a4a4;">IN</span>
        space = <span style="color: #98971a;">"_"</span>

BoardEmpty ==
    <span style="color: #C18E76;">\* There does not exist</span>
    \A i \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>, j \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>:
        <span style="color: #C18E76;">\* an empty space</span>
        <span style="color: #66a4a4;">LET</span> space == board[i][j] <span style="color: #66a4a4;">IN</span>
        space = <span style="color: #98971a;">"_"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-definindo-ganhar-coordenadas-2" class="outline-3">
<h3 id="definindo-ganhar-coordenadas-2"><span class="section-number-3">4.5.</span> Definindo &ldquo;ganhar&rdquo; - coordenadas</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li>Como o tabuleiro é sempre 3x3, é mais fácil listar todas as combinações de coordenadas que levam a uma vitória do que implementar os cálculos.<br /></li>
<li>Usamos tuplas! Na implementação em Quint, usamos <code>filter</code> e <code>size</code> para ver se um <i>pattern</i> tinha dois X e um branco, um X e dois brancos, etc. Aqui, o autor usa listas de permutação.<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-tla">WinningPositions == {
    <span style="color: #C18E76;">\* Horizonal wins</span>
    &lt;&lt;&lt;&lt;1,1&gt;&gt;, &lt;&lt;1,2&gt;&gt;, &lt;&lt;1,3&gt;&gt;&gt;&gt;,
    &lt;&lt;&lt;&lt;2,1&gt;&gt;, &lt;&lt;2,2&gt;&gt;, &lt;&lt;2,3&gt;&gt;&gt;&gt;,
    &lt;&lt;&lt;&lt;3,1&gt;&gt;, &lt;&lt;3,2&gt;&gt;, &lt;&lt;3,3&gt;&gt;&gt;&gt;,
    <span style="color: #C18E76;">\* Vertical wins</span>
    &lt;&lt;&lt;&lt;1,1&gt;&gt;, &lt;&lt;2,1&gt;&gt;, &lt;&lt;3,1&gt;&gt;&gt;&gt;,
    &lt;&lt;&lt;&lt;1,2&gt;&gt;, &lt;&lt;2,2&gt;&gt;, &lt;&lt;3,2&gt;&gt;&gt;&gt;,
    &lt;&lt;&lt;&lt;1,3&gt;&gt;, &lt;&lt;2,3&gt;&gt;, &lt;&lt;3,3&gt;&gt;&gt;&gt;,
    <span style="color: #C18E76;">\* Diagonal wins</span>
    &lt;&lt;&lt;&lt;1,1&gt;&gt;, &lt;&lt;2,2&gt;&gt;, &lt;&lt;3,3&gt;&gt;&gt;&gt;,
    &lt;&lt;&lt;&lt;3,1&gt;&gt;, &lt;&lt;2,2&gt;&gt;, &lt;&lt;1,3&gt;&gt;&gt;&gt;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-definindo-ganhar-operador-won-2" class="outline-3">
<h3 id="definindo-ganhar-operador-won-2"><span class="section-number-3">4.6.</span> Definindo &ldquo;ganhar&rdquo; - operador won</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Usamos a definição para <code>winningPositions</code> para determinar se um jogador venceu.<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">Won(player) ==
    <span style="color: #C18E76;">\* A player has won if there exists a winning position</span>
    \E winningPosition \in WinningPositions:
        <span style="color: #C18E76;">\* Where all the needed spaces</span>
        \A i \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>:
            <span style="color: #C18E76;">\* are occupied by one player</span>
            board[winningPosition[i][<span style="color: #d79921; font-weight: bold;">1</span>]][winningPosition[i][<span style="color: #d79921; font-weight: bold;">2</span>]] = player
</pre>
</div>
</div>
</div>
<div id="outline-container-a-es-move-2" class="outline-3">
<h3 id="a-es-move-2"><span class="section-number-3">4.7.</span> Ações - Move</h3>
<div class="outline-text-3" id="text-4-7">
<p>
Um dado jogador faz uma jogada (um <i>move</i>) em uma dada coordenada<br />
</p>
<ul class="org-ul">
<li>Determinístico<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-tla">Move(player, coordinate) ==
    /\ board[coordinate[<span style="color: #d79921; font-weight: bold;">1</span>]][coordinate[<span style="color: #d79921; font-weight: bold;">2</span>]] = <span style="color: #98971a;">"_"</span>
    /\ board' = [board <span style="color: #66a4a4;">EXCEPT</span>
                        ![coordinate[<span style="color: #d79921; font-weight: bold;">1</span>]][coordinate[<span style="color: #d79921; font-weight: bold;">2</span>]] = player]

</pre>
</div>
<ul class="org-ul">
<li><p>
Qual é a pré-condição pra essa ação?<br />
</p>
<ul class="org-ul">
<li>A pré-condição para essa ação é que a coordenada esteja vazia<br /></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-a-es-movetoempty-2" class="outline-3">
<h3 id="a-es-movetoempty-2"><span class="section-number-3">4.8.</span> Ações - MoveToEmpty</h3>
<div class="outline-text-3" id="text-4-8">
<p>
Um dado jogador faz uma jogada em <b>alguma</b> coordenada<br />
</p>
<ul class="org-ul">
<li>Não-determinístico<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-tla">MoveToEmpty(player) ==
  /\ \E i \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>: \E j \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span>: <span style="color: #C18E76;">\* There exists a position on the board</span>
    /\ board[i][j] = <span style="color: #98971a;">"_"</span> <span style="color: #C18E76;">\* Where the board is currently empty</span>
    /\ Move(player, &lt;&lt;i,j&gt;&gt;)
</pre>
</div>
<ul class="org-ul">
<li><p>
Qual é a pré-condição pra essa ação?<br />
</p>
<ul class="org-ul">
<li>A pré-condição para essa ação é que o jogo ainda não tenha acabado<br /></li>
</ul></li>
<li><p>
Aonde temos não determinismo aqui?<br />
</p>
<ul class="org-ul">
<li>No uso da ação <code>Move</code>, que atualiza a variável <code>board</code> dentro de um <i>exists</i> (<code>\E</code>).<br /></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-a-es-moveo-2" class="outline-3">
<h3 id="a-es-moveo-2"><span class="section-number-3">4.9.</span> Ações - MoveO</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-tla">MoveO ==
  /\ nextTurn = <span style="color: #98971a;">"O"</span> <span style="color: #C18E76;">\* Only enabled on O's turn</span>
  /\ ~Won(<span style="color: #98971a;">"X"</span>) <span style="color: #C18E76;">\* And X has not won</span>
  /\ MoveToEmpty(<span style="color: #98971a;">"O"</span>) <span style="color: #C18E76;">\* O still tries every empty space</span>
  /\ nextTurn' = <span style="color: #98971a;">"X"</span> <span style="color: #C18E76;">\* The future state of next turn is X</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
Qual é a pré-condição pra essa ação?<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">    /\ nextTurn = <span style="color: #98971a;">"O"</span> <span style="color: #C18E76;">\* Only enabled on O's turn</span>
    /\ ~Won(<span style="color: #98971a;">"X"</span>) <span style="color: #C18E76;">\* And X has not won</span>
</pre>
</div>
<ul class="org-ul">
<li>Implicitamente, também temos a pré-condição de <code>MoveToEmpty</code> empregada nessa ação<br /></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-estrat-gia-para-o-jogador-x-2" class="outline-3">
<h3 id="estrat-gia-para-o-jogador-x-2"><span class="section-number-3">4.10.</span> Estratégia para o jogador X</h3>
<div class="outline-text-3" id="text-4-10">
<p>
<b>Estratégia</b>:<br />
</p>
<ul class="org-ul">
<li>A primeira jogada é sempre nos cantos<br /></li>
<li>As outras jogadas fazem a primeira jogada possível nessa lista de prioridade:<br />
<ul class="org-ul">
<li>Ganhar<br /></li>
<li>Bloquear<br /></li>
<li>Jogar no centro<br /></li>
<li>Preparar uma vitória (preenchendo 2 de 3 quadrados numa fila/coluna/diagonal)<br /></li>
<li>Jogada qualquer<br /></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-come-ando-com-os-cantos-2" class="outline-3">
<h3 id="come-ando-com-os-cantos-2"><span class="section-number-3">4.11.</span> Começando com os cantos</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-tla">Corners == {
    &lt;&lt;1,1&gt;&gt;,
    &lt;&lt;3,1&gt;&gt;,
    &lt;&lt;1,3&gt;&gt;,
    &lt;&lt;3,3&gt;&gt;
}

StartInCorner ==
    \E corner \in Corners:
        Move(<span style="color: #98971a;">"X"</span>, corner)
</pre>
</div>
</div>
</div>
<div id="outline-container-condi-es-para-as-jogadas-2" class="outline-3">
<h3 id="condi-es-para-as-jogadas-2"><span class="section-number-3">4.12.</span> Condições para as jogadas</h3>
<div class="outline-text-3" id="text-4-12">
<p>
Precisamos definir as condições que determinam se cada uma das jogadas na lista de prioridade pode ser feita.<br />
</p>
<p>
Para isso, nessa especificação, definimos as permutações, e fazemos um nível a mais de interação (com <i>exists</i>), verificando, para cada <code>winningPosition</code> e para cada permutação, se aquela permutação da <code>winningPosition</code> é uma ordem específica do que queremos (X, X, e vazio).<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">PartialWins == {
    &lt;&lt;1,<span style="color: #d79921; font-weight: bold;">2</span>,3&gt;&gt;,
    &lt;&lt;2,<span style="color: #d79921; font-weight: bold;">3</span>,1&gt;&gt;,
    &lt;&lt;3,<span style="color: #d79921; font-weight: bold;">1</span>,2&gt;&gt;
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-tla">CanWin == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]],<span style="color: #98971a;">"_"</span>)

CanBlockWin == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]], <span style="color: #98971a;">"O"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]], <span style="color: #98971a;">"O"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]], <span style="color: #98971a;">"_"</span>)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-tla">CanTakeCenter == board[<span style="color: #d79921; font-weight: bold;">2</span>][<span style="color: #d79921; font-weight: bold;">2</span>] = <span style="color: #98971a;">"_"</span>

CanSetupWin == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]], <span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]], <span style="color: #98971a;">"_"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]], <span style="color: #98971a;">"_"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-a-es-win-2" class="outline-3">
<h3 id="a-es-win-2"><span class="section-number-3">4.13.</span> Ações - Win</h3>
<div class="outline-text-3" id="text-4-13">
<div class="org-src-container">
<pre class="src src-tla">Win == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]],<span style="color: #98971a;">"_"</span>)
  /\ Move(<span style="color: #98971a;">"X"</span>, winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]])
</pre>
</div>

<ul class="org-ul">
<li>Qual é a pré-condição pra essa ação?<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-tla">\E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]],<span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]],<span style="color: #98971a;">"_"</span>)

</pre>
</div>
<ul class="org-ul">
<li>Percebam que essa pré condição é exatamente <code>CanWin</code><br /></li>
<li>Porém, não conseguimos usar <code>CanWin</code> aqui porque precisamos saber em qual posição jogar.<br /></li>
</ul>
</div>
</div>
<div id="outline-container-a-es-blockwin-2" class="outline-3">
<h3 id="a-es-blockwin-2"><span class="section-number-3">4.14.</span> Ações - BlockWin</h3>
<div class="outline-text-3" id="text-4-14">
<p>
De forma semelhante, <code>BlockWin</code>:<br />
</p>
<div class="org-src-container">
<pre class="src src-tla">BlockWin == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]], <span style="color: #98971a;">"O"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]], <span style="color: #98971a;">"O"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]], <span style="color: #98971a;">"_"</span>)
  /\ Move(<span style="color: #98971a;">"X"</span>, winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]])
</pre>
</div>
</div>
</div>
<div id="outline-container-a-es-takecenter-e-setupwin-2" class="outline-3">
<h3 id="a-es-takecenter-e-setupwin-2"><span class="section-number-3">4.15.</span> Ações - TakeCenter e SetupWin</h3>
<div class="outline-text-3" id="text-4-15">
<div class="org-src-container">
<pre class="src src-tla">TakeCenter ==
    /\ Move(<span style="color: #98971a;">"X"</span>, &lt;&lt;2,2&gt;&gt;)

SetupWin == \E winningPostion \in WinningPositions, partialWin \in PartialWins:
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">1</span>]], <span style="color: #98971a;">"X"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">2</span>]], <span style="color: #98971a;">"_"</span>)
  /\ BoardIs(winningPostion[partialWin[<span style="color: #d79921; font-weight: bold;">3</span>]], <span style="color: #98971a;">"_"</span>)
  /\ \E i \in <span style="color: #d79921; font-weight: bold;">2</span>..<span style="color: #d79921; font-weight: bold;">3</span>:
    Move(<span style="color: #98971a;">"X"</span>, winningPostion[partialWin[i]])
</pre>
</div>
</div>
</div>
<div id="outline-container-a-es-movex-2" class="outline-3">
<h3 id="a-es-movex-2"><span class="section-number-3">4.16.</span> Ações - MoveX</h3>
<div class="outline-text-3" id="text-4-16">
<div class="org-src-container">
<pre class="src src-tla">MoveX ==
    /\ nextTurn = <span style="color: #98971a;">"X"</span> <span style="color: #C18E76;">\* Only enabled on X's turn</span>
    /\ ~Won(<span style="color: #98971a;">"O"</span>) <span style="color: #C18E76;">\* And X has not won</span>
    <span style="color: #C18E76;">\* This specifies the spots X will move on X's turn</span>
    /\ \/ /\ BoardEmpty
          /\ StartInCorner
       \/ /\ ~BoardEmpty <span style="color: #C18E76;">\* If its not the start</span>
          /\ \/ /\ CanWin
                /\ Win
             \/ /\ ~CanWin
                /\  \/ /\ CanBlockWin
                       /\ BlockWin
                    \/ /\ ~CanBlockWin
                       /\ \/ /\ CanTakeCenter
                             /\ TakeCenter
                          \/ /\ ~CanTakeCenter
                             /\ \/ /\ CanSetupWin
                                   /\ SetupWin
                                \/ /\ ~CanSetupWin
                                  /\ MoveToEmpty(<span style="color: #98971a;">"X"</span>) <span style="color: #C18E76;">\* No more strategies. Pick spot</span>
    /\ nextTurn' = <span style="color: #98971a;">"O"</span> <span style="color: #C18E76;">\* The future state of next turn is O</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-estado-inicial-2-2" class="outline-3">
<h3 id="estado-inicial-2-2"><span class="section-number-3">4.17.</span> Estado inicial</h3>
<div class="outline-text-3" id="text-estado-inicial-2-2">
<div class="org-src-container">
<pre class="src src-tla">Init ==
  /\ nextTurn = <span style="color: #98971a;">"X"</span> <span style="color: #C18E76;">\* X always goes first</span>
  <span style="color: #C18E76;">\* Every space in the board states blank</span>
  /\ board = [i \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span> |-&gt; [j \in <span style="color: #d79921; font-weight: bold;">1</span>..<span style="color: #d79921; font-weight: bold;">3</span> |-&gt; <span style="color: #98971a;">"_"</span>]]
</pre>
</div>
</div>
</div>
<div id="outline-container-transi-es-2" class="outline-3">
<h3 id="transi-es-2"><span class="section-number-3">4.18.</span> Transições</h3>
<div class="outline-text-3" id="text-4-18">
<div class="org-src-container">
<pre class="src src-tla">GameOver == Won(<span style="color: #98971a;">"X"</span>) /\ Won(<span style="color: #98971a;">"O"</span>) /\ BoardFilled

<span style="color: #C18E76;">\* Every state, X will move if X's turn, O will move on O's turn</span>
Next == MoveX \/ MoveO \/ (GameOver /\ <span style="color: #66a4a4;">UNCHANGED</span> &lt;&lt; board, nextTurn &gt;&gt;)
</pre>
</div>

<ul class="org-ul">
<li>Nota: isso está um pouco diferente na especificação inicial. Veremos isso na aula sobre fórmulas temporais em TLA+.<br /></li>
</ul>
</div>
</div>
<div id="outline-container-invariantes-2" class="outline-3">
<h3 id="invariantes-2"><span class="section-number-3">4.19.</span> Invariantes</h3>
<div class="outline-text-3" id="text-4-19">
<div class="org-src-container">
<pre class="src src-tla">XHasNotWon == ~Won(<span style="color: #98971a;">"X"</span>)
OHasNotWon == ~Won(<span style="color: #98971a;">"O"</span>)

<span style="color: #C18E76;">\* It's not a stalemate if one player has won or the board is not filled</span>
NotStalemate ==
    \/ Won(<span style="color: #98971a;">"X"</span>)
    \/ Won(<span style="color: #98971a;">"O"</span>)
    \/ ~BoardFilled
</pre>
</div>
</div>
</div>
<div id="outline-container-refer-ncias-2" class="outline-3">
<h3 id="refer-ncias-2"><span class="section-number-3">4.20.</span> Referências</h3>
<div class="outline-text-3" id="text-4-20">
<div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>SWART, E. <b>Introduction to pragmatic formal modeling</b>. Disponível em: &#60;<a href="https://elliotswart.github.io/pragmaticformalmodeling/">https://elliotswart.github.io/pragmaticformalmodeling/</a>&#62;. </div>
</div>
</div>
</div>
</div>

      </div>
    </div>
  </body>
</html>
